var main = require("./main");
var historyQuery = require("./historyQuery");

var testVisits = '[{"id":207939,"from_visit":207937,"placeId":158892,"visit_date":1395446307675324,"visit_type":1,"url":"http://www.bing.com/search?q=json+javascript+stringify+parse+%22after+property+value+in+object%22&qs=n&form=QBRE&pq=json+javascript+stringify+parse+%22after+property+value+in+object%22&sc=0-31&sp=-1&sk=&cvid=e993e846b35d4aeaa0c2577b5369bb8f","label":"json javascript stringify parse \"after property value in object\" - Bing"},{"id":207938,"from_visit":207937,"placeId":158891,"visit_date":1395446271192586,"visit_type":1,"url":"http://stackoverflow.com/questions/1438062/json-parse-stringify-parse-broken","label":"javascript - JSON parse -> stringify -> parse broken? - Stack Overflow"},{"id":207937,"from_visit":207936,"placeId":158890,"visit_date":1395446264442751,"visit_type":1,"url":"http://www.bing.com/search?q=json+javascript+stringify+parse&qs=n&form=QBRE&pq=json+javascript+stringify+parse&sc=0-0&sp=-1&sk=&cvid=257564ff22844889a1ddbf23c46a9c88","label":"json javascript stringify parse - Bing"},{"id":207936,"from_visit":0,"placeId":158889,"visit_date":1395446246601554,"visit_type":1,"url":"http://www.bing.com/search?q=json+javascript+stringify+url&qs=n&form=QBRE&pq=json+javascript+stringify+ur&sc=0-26&sp=-1&sk=&cvid=b55eca0857944b4097644b5fbf8bbc26","label":"json javascript stringify url - Bing"},{"id":207935,"from_visit":207934,"placeId":158888,"visit_date":1395444739554406,"visit_type":1,"url":"https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/test_assert","label":"test/assert - Mozilla | MDN"},{"id":207934,"from_visit":0,"placeId":158887,"visit_date":1395444737232946,"visit_type":1,"url":"http://www.bing.com/search?q=addon-sdk+mozilla+assert+test&form=MOZSBR","label":"addon-sdk mozilla assert test - Bing"},{"id":207933,"from_visit":207931,"placeId":158886,"visit_date":1395423868518819,"visit_type":1,"url":"http://www.bing.com/search?q=nsPIPlacesDatabase+mozilla&qs=n&pq=nspiplacesdatabase+mozilla&sc=0-18&sp=-1&sk=&cvid=9402585fb6bf4037bc4bacc3235d3a7b&first=9&FORM=PORE","label":"nsPIPlacesDatabase mozilla - Bing"},{"id":207932,"from_visit":207931,"placeId":158885,"visit_date":1395423865812494,"visit_type":1,"url":"http://www.oxymoronical.com/experiments/apidocs/interface/nsPIPlacesDatabase","label":"nsPIPlacesDatabase Interface"},{"id":207931,"from_visit":207930,"placeId":158884,"visit_date":1395423825899220,"visit_type":1,"url":"http://www.bing.com/search?q=nsPIPlacesDatabase+mozilla&qs=n&form=QBRE&pq=nspiplacesdatabase+mozilla&sc=0-18&sp=-1&sk=&cvid=9402585fb6bf4037bc4bacc3235d3a7b","label":"nsPIPlacesDatabase mozilla - Bing"},{"id":207930,"from_visit":0,"placeId":158883,"visit_date":1395423787287441,"visit_type":1,"url":"http://www.bing.com/search?q=nsPIPlacesDatabase&form=MOZSBR","label":"nsPIPlacesDatabase - Bing"},{"id":207929,"from_visit":0,"placeId":41596,"visit_date":1395421347379110,"visit_type":2,"url":"http://www.sohu.com/","label":"搜狐-中国最大的门户网站"},{"id":207928,"from_visit":207927,"placeId":158882,"visit_date":1395421333256225,"visit_type":1,"url":"http://freshexpressway.com/comingsoon.html","label":"Fresh Express Way, Your way to healthier food"},{"id":207927,"from_visit":0,"placeId":120944,"visit_date":1395421332747531,"visit_type":2,"url":"http://freshexpressway.com/","label":null},{"id":207926,"from_visit":0,"placeId":144938,"visit_date":1395419114655730,"visit_type":1,"url":"https://developer.mozilla.org/en-US/Add-ons/SDK/Guides/Content_Scripts","label":"Content Scripts - Mozilla | MDN"},{"id":207925,"from_visit":207924,"placeId":158881,"visit_date":1395417384150898,"visit_type":6,"url":"http://www.bing.com/search?q=divergent+movie&FORM=ML0V1J&OCID=ML0V1J&PUBL=BING&CREA=ML0V1J","label":"divergent movie - Bing"},{"id":207924,"from_visit":0,"placeId":158880,"visit_date":1395417383998921,"visit_type":1,"url":"http://www.bing.com/rewardsapp/redirect?url=%2fsearch%3fq%3ddivergent%2bmovie%26FORM%3dML0V1J%26OCID%3dML0V1J%26PUBL%3dBING%26CREA%3dML0V1J&id=a260214161&hash=54ef2948d59989bd9613b5a6eb05777e&state=Active&rcid=0&aid=urlreward&bruid=67816447-44E4-4D62-BD78-660A0F54394B&ml=ExpandedWebLayout&nid=&rh=","label":null},{"id":207923,"from_visit":207921,"placeId":158879,"visit_date":1395386539513739,"visit_type":1,"url":"http://www.bing.com/search?q=xul+addon-sdk+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=xul+addon-sdk+site%3Adeveloper.mozilla.org&sc=0-34&sp=-1&sk=&cvid=9130924b3b694d24b8286bdcd48a44fd","label":"xul addon-sdk site:developer.mozilla.org - Bing"},{"id":207922,"from_visit":207921,"placeId":158878,"visit_date":1395386514059093,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/Jetpack/UI/Menu","label":"Menu - Jetpack | MDN"},{"id":207921,"from_visit":207913,"placeId":158877,"visit_date":1395386507656251,"visit_type":1,"url":"http://www.bing.com/search?q=xul+jetpack+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=xul+jetpack+site%3Adeveloper.mozilla.org&sc=0-34&sp=-1&sk=&cvid=64a1cf47fef04a75abf861c6a5d806a2","label":"xul jetpack site:developer.mozilla.org - Bing"},{"id":207920,"from_visit":0,"placeId":128854,"visit_date":1395386452099145,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsITreeView","label":"nsITreeView - XPCOM Interface Reference | MDN"},{"id":207919,"from_visit":207916,"placeId":158876,"visit_date":1395386104323839,"visit_type":1,"url":"https://bugzilla.mozilla.org/show_bug.cgi?id=320831","label":"320831 – Expose visit ID in result nodes."},{"id":207918,"from_visit":207916,"placeId":158875,"visit_date":1395386090184855,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsINavHistoryResult","label":"Not Found | MDN"},{"id":207917,"from_visit":207916,"placeId":158874,"visit_date":1395386025070353,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsINavHistoryQueryOptions","label":"nsINavHistoryQueryOptions - XPCOM Interface Reference | MDN"},{"id":207916,"from_visit":207915,"placeId":158873,"visit_date":1395386001615889,"visit_type":5,"url":"https://developer.mozilla.org/en-US/docs/Querying_Places","label":"Querying Places | MDN"},{"id":207915,"from_visit":207914,"placeId":158872,"visit_date":1395386001279425,"visit_type":1,"url":"https://developer.mozilla.org/en/Querying_Places","label":null},{"id":207914,"from_visit":207913,"placeId":158871,"visit_date":1395385955037224,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/Places/History_Service_Design?redirectlocale=en-US&redirectslug=Places%2FHistory_Service%2FDesign","label":"History Service Design - Places | MDN"},{"id":207913,"from_visit":207912,"placeId":158870,"visit_date":1395385931517140,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+places+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=tree+type+places+site%3Adeveloper.mozilla.org&sc=0-42&sp=-1&sk=&cvid=e3398a191c2043d0b8ce8e214c854fae","label":"tree type places site:developer.mozilla.org - Bing"},{"id":207912,"from_visit":207911,"placeId":158869,"visit_date":1395385924229686,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+place+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=tree+type+place+site%3Adeveloper.mozilla.org&sc=0-36&sp=-1&sk=&cvid=f95d34e35e4e4dcc915ec76d4f974c18","label":"tree type place site:developer.mozilla.org - Bing"},{"id":207911,"from_visit":207910,"placeId":158868,"visit_date":1395385916975932,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=tree+type+site%3Adeveloper.mozilla.org&sc=8-36&sp=-1&sk=&cvid=c80c2ec1bafe48dcb18536a273993572","label":"tree type site:developer.mozilla.org - Bing"},{"id":207910,"from_visit":207909,"placeId":158867,"visit_date":1395385907740831,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+-xul+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=tree+type+-xul+site%3Adeveloper.mozilla.org&sc=8-41&sp=-1&sk=&cvid=c9dfa765e25d4d75ab0b465ef0f31374","label":"tree type -xul site:developer.mozilla.org - Bing"},{"id":207909,"from_visit":207908,"placeId":158866,"visit_date":1395385893455797,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+site%3Adeveloper.mozilla.org&qs=n&form=QBRE&pq=tree+type+site%3Adeveloper.mozilla.org&sc=8-36&sp=-1&sk=&cvid=a384b24859da4c719973d8605a555b72","label":"tree type site:developer.mozilla.org - Bing"},{"id":207908,"from_visit":0,"placeId":158865,"visit_date":1395385888860039,"visit_type":1,"url":"http://www.bing.com/search?q=tree+type+developer.mozilla.org&form=MOZSBR","label":"tree type developer.mozilla.org - Bing"},{"id":207907,"from_visit":207906,"placeId":158864,"visit_date":1395385573109730,"visit_type":1,"url":"http://www.gmc.com/current-offers.html?x-zipcode=94085&x-bodystyle=yukon_xl&x-carline=yukon&x-year=2015","label":"Current Offers, Lease Deals and Specials"},{"id":207906,"from_visit":207905,"placeId":158863,"visit_date":1395385553008314,"visit_type":1,"url":"http://www.gmc.com/yukon-xl-full-size-suv.html","label":"2015 Yukon XL Extended Full Size SUV"},{"id":207905,"from_visit":0,"placeId":158862,"visit_date":1395385547840459,"visit_type":1,"url":"http://www.bing.com/search?q=yukon+xl&form=MOZSBR","label":"yukon xl - Bing"},{"id":207904,"from_visit":0,"placeId":158859,"visit_date":1395385136913293,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/Displaying_Places_information_using_views#Creating_custom_views","label":"Displaying Places information using views | MDN"},{"id":207903,"from_visit":207902,"placeId":158861,"visit_date":1395385125092680,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIPlacesView","label":"Not Found | MDN"},{"id":207902,"from_visit":0,"placeId":158860,"visit_date":1395385110002973,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/Displaying_Places_information_using_views#Tree_view","label":"Displaying Places information using views | MDN"},{"id":207901,"from_visit":0,"placeId":158859,"visit_date":1395385069856375,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/Displaying_Places_information_using_views#Creating_custom_views","label":"Displaying Places information using views | MDN"},{"id":207900,"from_visit":207899,"placeId":128854,"visit_date":1395384862483577,"visit_type":1,"url":"https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsITreeView","label":"nsITreeView - XPCOM Interface Reference | MDN"}]';

var testTree = '[{"id":207907,"from_visit":207906,"placeId":158864,"visit_date":1395385573109730,"visit_type":1,"url":"http://www.gmc.com/current-offers.html?x-zipcode=94085&x-bodystyle=yukon_xl&x-carline=yukon&x-year=2015","label":"Current Offers, Lease Deals and Specials"},{"id":207906,"from_visit":207905,"placeId":158863,"visit_date":1395385553008314,"visit_type":1,"url":"http://www.gmc.com/yukon-xl-full-size-suv.html","label":"2015 Yukon XL Extended Full Size SUV"},{"id":207905,"from_visit":0,"placeId":158862,"visit_date":1395385547840459,"visit_type":1,"url":"http://www.bing.com/search?q=yukon+xl&form=MOZSBR","label":"yukon xl - Bing"}]';

var exported = '[{"id":null,"placeId":null,"label":"addon-sdk mozilla assert test - Bing","url":"http://www.bing.com/search?q=addon-sdk+mozilla+assert+test&form=MOZSBR","isContainer":true,"isFolded":true,"children":[{"id":null,"placeId":null,"label":"test/assert - Mozilla | MDN","url":"https://developer.mozilla.org/en-US/Add-ons/SDK/Low-Level_APIs/test_assert","isContainer":false,"isFolded":true,"children":[],"level":1}],"level":0}]';

exports["test historyQuery"] = function(assert) {
  assert.ok(testVisits.length>0, "check test array length");
  var littleTree = JSON.parse(testTree);
  assert.ok(testTree.length>0, "check test tree length");
  var tree = historyQuery.getThreads(littleTree);
  assert.ok(tree.length==1, "top node is 1");
  var top = tree[0];
  assert.ok(top.id==207905, "topid correct");
  assert.equal(top.children.length, 1, "direct children should be 1");
  console.log(JSON.stringify(tree));
};

exports["test main async"] = function(assert, done) {
  assert.pass("async Unit test running!");
  done();
};

require("sdk/test").run(exports);
